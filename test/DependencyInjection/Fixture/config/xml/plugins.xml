<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xmlns:prooph="http://getprooph.org/schemas/symfony-dic/prooph"
               xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd
                        http://getprooph.org/schemas/symfony-dic/prooph http://getprooph.org/schemas/symfony-dic/prooph/service_bus-5.1.xsd">

    <prooph:config>
        <prooph:command_bus name="main_command_bus" message_factory="prooph_service_bus.message_factory">
            <prooph:plugin>prooph_service_bus.handle_command_invoke_strategy</prooph:plugin>
            <prooph:router type="prooph_service_bus.command_bus_router">
                <prooph:route command="Prooph\ProophessorDo\Model\User\Command\RegisterUser">ProophTest\Bundle\ServiceBus\DependencyInjection\Fixture\Model\AcmeRegisterUserHandler</prooph:route>
            </prooph:router>
        </prooph:command_bus>
        <!-- uses default values -->
        <prooph:command_bus name="second_command_bus">
            <prooph:plugin>prooph_service_bus.handle_command_invoke_strategy</prooph:plugin>
            <prooph:plugin>prooph_service_bus.handle_command_invoke_strategy</prooph:plugin>
            <prooph:router>
                <prooph:route command="Prooph\ProophessorDo\Model\User\Command\RegisterUser">ProophTest\Bundle\ServiceBus\DependencyInjection\Fixture\Model\AcmeRegisterUserHandler</prooph:route>
            </prooph:router>
        </prooph:command_bus>

        <prooph:event_bus name="main_event_bus" message_factory="prooph_service_bus.message_factory">
            <prooph:plugin>prooph_service_bus.on_event_invoke_strategy</prooph:plugin>
            <prooph:router type="prooph_service_bus.event_bus_router">
                <prooph:route event="Prooph\ProophessorDo\Model\Todo\Event\TodoWasPosted">
                    <prooph:listener>ProophTest\Bundle\ServiceBus\DependencyInjection\Fixture\Model\TodoProjector</prooph:listener>
                    <prooph:listener>ProophTest\Bundle\ServiceBus\DependencyInjection\Fixture\Model\UserProjector</prooph:listener>
                </prooph:route>
            </prooph:router>
        </prooph:event_bus>
    </prooph:config>

    <services>
        <prototype namespace="ProophTest\Bundle\ServiceBus\" resource="../../../../*" />
        <service id="global_plugin" class="ProophTest\Bundle\ServiceBus\DependencyInjection\Fixture\Model\GlobalPlugin" public="true">
            <tag name="prooph_service_bus.plugin" />
        </service>
        <service id="command_type_plugin" class="ProophTest\Bundle\ServiceBus\DependencyInjection\Fixture\Model\CommandTypePlugin" public="true">
            <tag name="prooph_service_bus.command_bus.plugin" />
        </service>
        <service id="main_command_bus_plugin" class="ProophTest\Bundle\ServiceBus\DependencyInjection\Fixture\Model\MainCommandBusPlugin" public="true">
            <tag name="prooph_service_bus.main_command_bus.plugin" />
        </service>
    </services>
</container>
